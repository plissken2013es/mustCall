var Game=function(){this.url=window.URL||window.webkitURL;this.init()};Game.prototype.init=function(){kontra.init();"s m b t z z2 f w h o1 o2 o3 o4 o5 o6 o7 o8 o9 o10".split(" ").forEach(function(h){kontra.assets.images[h]=document.getElementById(h)});this.main()};
Game.prototype.main=function(){function h(a,b){b.src=a;b.play()}function Y(){var a=0,b=0,c=0,d=0;.04>e()&&(a=4*e(),b=4*e(),c=40*e(),d=12*e());a=k.createRadialGradient(148+(a|0),90+b,15+a-b,150+c,70+d,100+c-d);a.addColorStop(0,"#ffffff11");a.addColorStop(1,"#00000099");k.fillStyle=a;k.fillRect(0,0,256,144)}function v(a,b,c,d){k.font="10px monospace";k.fillStyle="#000000";k.fillText(c,a,b);k.fillStyle=d||"#ffffff";k.fillText(c,a-1,b-1)}function n(a){var b=a/60|0;a-=60*b;return(10>b?"0"+b:b)+":"+(10>
a?"0"+a:a)}function J(){d=d.sort(function(a,b){return a.s>b.s?1:a.s<b.s?-1:0})}function Z(){B=aa*(1-C)+2*e();r=0;var a=e()*S.length|0;e()<.25+.1*C&&(a=0);var b=S[a];a={x:256,y:t+(b.posy||2),offset:b.off||0,dx:b.dx||-1};b.spr?a.image=kontra.assets.images[b.spr]:(b=kontra.spriteSheet({image:kontra.assets.images[b.anim],frameWidth:b.fw,frameHeight:b.fh,animations:{idle:{frames:b.frms,frameRate:b.fr}}}),a.animations=b.animations);D.push(kontra.sprite(a))}function ba(){if(r>B){r=0;var a=ca.shift();a?(B=
a.p,T.text=a.t):K.s||(h(da,w),K.s=!0,ea.style.display="block")}}function fa(){if(x>E)if(x=0,E=U+e()*(5+5*C),0==y.length){var a=F.shift();a&&(y=a.s)}else y=""}function ha(){J();0<p&&f>p&&(z("CONGRATS! YOU JUST BEAT YOUR BEST SCORE!",!0),h(L,M));var a=d.find(function(a){return a.s<f});a&&(z("You just BEAT "+a.n+"'s highscore of "+n(a.s),!0),h(L,M));(a=d.find(function(a){return a.s>f}))&&z("NEXT highscore: "+a.n+" -> "+n(a.s),!1)}function ia(){F.forEach(function(a,b){a.p||F.splice(b,1)})}function ja(){h(ka,
w);q=!0;ia();N={};f>p&&(p=f);var a=d.findIndex(function(a){return a.s>f}),b=-1;0>a&&(a=d.length);d[a-1]&&(b={n:O,s:f},d.push(b),u.emit("beat",b),a++,b=a-2);J();if(0<=b){a=[];for(var c=b;c<b+3;c++)d[c]&&a.push(d.length-c+"."+d[c].n+" "+n(d[c].s));G=a;y="";x=E=0}f=0}function z(a,b){N[a]||(F.push({s:a,p:b}),N[a]=!0)}function V(a){var b=kontra.canvas.getBoundingClientRect(),d=a.clientY-b.top;99>Math.abs(a.clientX-b.left)&&99>Math.abs(d)&&window.open("http://twitter.com/intent/tweet?url=http://www.js13kgames.com/entries/i-must-call-my-grandmother&text=I survived the offline apocalypse for "+
n(p)+". Dare you!&hashtags=mustCallMyGrandmaTheGame&via=impactophaser","_blank");A||c.isJumping||q||(h(la,w),c.isJumping=!0,c.isOver=!1,c.isColliding&&!q&&(c.verticalJump=!0),c.ddy=-2)}var u=io({upgrade:!1,transports:["websocket"]}),ea=document.getElementById("nm"),ma=document.getElementById("ni");document.getElementById("nb");(function(){u.on("new",function(a){z("New online player has joined: "+a,!0)});u.on("beat",function(a){z("NEW "+a.n+"'s HIGHSCORE! -> "+n(a.s),!0);h(L,M)});u.on("scores",function(a){d=
a;J()})})();for(var P=Math,e=P.random,la=jsfxr([0,,.3433,,.168,.3024,,.1901,,,,,,.185,,,,,1,,,,,.5]),ka=jsfxr([1,.1477,.616,.4993,.3202,.5067,,-.0011,-.1641,,.0282,-.1922,.6789,.9542,.5482,.2699,-7E-4,-.386,.9599,-.5059,.4179,.0777,.0307,.25]),W=jsfxr([2,,.0881,,.1905,.3526,,-.5607,,,,,,,,,,,1,,,,,.4]),da=jsfxr([3,.55,.53,,.56,.0628,,1,1,1,,,,-.0465,-.0438,.22,,,.82,-.0999,.52,.0314,-.0015,.58]),L=jsfxr([3,.5671,.5744,.2934,.4225,.6162,.0364,.3683,.1388,.0135,.17,-.5264,.4169,.0375,-.0094,.62,.48,
-.9964,.9285,.2633,,.2613,-.0046,.5]),w=new Audio,M=new Audio,O,k=kontra.context,H=[],D=[],t=102,r=0,B=2*e(),q=!0,f=0,p=0,Q=0,C=0,aa=1,A=!0,x=0,U=2,E=U+5*e(),y="",G=[],ca=[{t:"Phone signal's gone!",p:2},{t:"",p:2},{t:"It's kind of an...",p:2},{t:"offline apocalypse!",p:2},{t:"",p:2},{t:"Any phone cabinet?",p:2},{t:"...because...",p:2},{t:"",p:2}],d=[],F=[{s:"Controls: press SPACE or Tap screen to jump"},{s:"Can you enter top 10 highscores?  Share it!"}],N={},S=[{anim:"z",off:14,fw:10,fh:16,frms:"0..5",
fr:6,dx:-1.2,posy:-1},{anim:"z2",off:13,fw:16,fh:10,frms:"0..5",fr:3,dx:-.9,posy:7},{spr:"o1",off:8},{spr:"o2",off:7},{spr:"o3",off:10},{anim:"o4",off:10,fw:12,fh:14,frms:[0,1],fr:8},{spr:"o5",off:12,posy:6},{spr:"o6",off:12,posy:8},{spr:"o7",off:13,posy:7},{spr:"o8",off:13,posy:8},{spr:"o9",off:13,posy:8},{spr:"o10",off:13,posy:4}],l=0;24>l;l++)for(var m=1;8>m;m++){var I=kontra.sprite({x:16*l,y:16*m,dx:-.8,image:kontra.assets.images.w});H.push(I)}for(l=0;17>l;l++)m=kontra.sprite({x:16*l,y:116,dx:-1,
image:kontra.assets.images.f}),H.push(m);var X=kontra.sprite({x:300,y:40,dx:-.8,image:kontra.assets.images.m,update:function(){this.advance();-50>this.x&&(this.x=300+300*P.random()|0)}});l=kontra.spriteSheet({image:kontra.assets.images.h,frameWidth:16,frameHeight:16,animations:{run:{frames:"2..8",frameRate:12},idle:{frames:[0,1],frameRate:6}}});var T=kontra.sprite({x:115,y:65,image:kontra.assets.images.b,text:"",hideB:!1,render:function(){0!=this.text.length&&(this.hideB||this.draw(),v(this.x+10,
this.y+16,this.text,this.hideB?"#fff":"#caca00"))}}),K=kontra.sprite({x:50,y:65,s:!1,image:kontra.assets.images.t,render:function(){this.s&&this.draw()}}),na=kontra.sprite({x:3,y:21,image:kontra.assets.images.s}),c=kontra.sprite({x:0,y:t,dt:0,blink:!1,animations:l.animations,update:function(a){this.dt+=a;.15<this.dt&&(this.dt=0,this.blink=!this.blink);this.advance();this.isJumping&&(this.ddy=.09,this.verticalJump||(this.dx=.3));160<this.x&&(this.dx=0,this.x|=0);if(this.y>t||this.isOver)this.isJumping=
!1,this.dx=this.dy=this.ddy=0,this.isOver||(this.y=t,h(W,w));this.isColliding&&(this.dx=this.isColliding.dx);this.isOver&&(this.dx=this.isOver.dx);0>this.dx?this.playAnimation("idle"):this.playAnimation("run")},render:function(){q?(e(),this.blink&&(k.save(),k.globalCompositeOperation="soft-light"),this.draw(),this.blink&&k.restore()):this.draw()}});l=kontra.spriteSheet({image:kontra.assets.images.z,frameWidth:10,frameHeight:16,animations:{i0:{frames:"0..5",frameRate:6},i1:{frames:"0..5",frameRate:9}}});
var R=[];for(m=0;7>m;m++)I=kontra.sprite({x:235+3*m+(6*e()-3),y:t,animations:l.animations,render:function(){var a=this.context;a.save();a.translate(261,0);a.scale(-1,1);this.draw();a.restore()}}),I.playAnimation(.5>e()?"i0":"i1"),R.push(I);addEventListener("click",V);nb.onclick=function(){nm.style.display="none";O=ma.value.slice(0,8)||"Player";u.emit("login",O);u.emit("scores");A=!1;f=0;window.snd.close()};kontra.keys.bind("space",V);kontra.gameLoop({update:function(a){q?(c.dx=1,c.y=t,108<c.x&&(c.x=
108,c.dx=0,q=!1,c.verticalJump=!1)):A?(r+=a,ba()):(Q+=a,r+=a,x+=a,r>B&&Z(),x>E&&(ha(),fa(),G=[]),1<=Q&&(f+=1,C=1-1/P.exp(f/150),Q=0));X.update();H.map(function(a){a.update();-16>=a.x&&(a.x=256)});c.isColliding=!1;D.map(function(a,d){a.update();c.collidesWith(a)&&(c.y<a.y-a.offset&&!c.isOver&&!c.verticalJump&&0<c.dy?(h(W,w),c.isOver=a,c.dy=0,c.ddy=0,c.y=a.y-a.offset-1):c.y>a.y-a.offset&&(c.isColliding=a));-16>=a.x&&D.splice(d,1)});c.update(a);-16>=c.x&&(q||ja());R.map(function(a){a.update()})},render:function(){A?
(T.render(),K.render()):(H.map(function(a){a.render()}),D.map(function(a){a.render()}),X.render(),0<p&&na.render(),v(180,30,n(f)),v(20,30,"BEST - "+n(p),"#ffff00"),v(10,45,y,"#00FF00"),G.forEach(function(a,b){v(10,75-10*b,G[b],1==b?"#5533ff":"#fff")}));c.render();A||(R.map(function(a){a.render()}),Y())}}).start()};var g=new Game;